{"version":3,"file":"_server.js","sources":["../../../../../../../src/routes/api/order/+server.js"],"sourcesContent":["import { json } from '@sveltejs/kit';\nimport * as Sentry from \"@sentry/sveltekit\";\nimport pkg from \"@logtail/js\";\nconst { Logtail } = pkg;\n\nconst logtail = pkg.Logtail ? new pkg.Logtail(process.env.LOGTAIL_SOURCE_TOKEN || \"fake-token\") : { info: () => {}, error: () => {} };\n\nexport const config = {\n    runtime: 'edge'\n};\n\n/** @type {import('./$types').RequestHandler} */\nexport async function POST({ request }) {\n    try {\n        const data = await request.json();\n        \n        // Geração de ID resiliente\n        const timestamp = Date.now().toString(36);\n        const randomStr = Math.random().toString(36).substring(2, 8);\n        const orderId = `ORD-${timestamp}-${randomStr}`.toUpperCase();\n\n        const logData = {\n            orderId,\n            itemsCount: data.items?.length,\n            total: data.total,\n            userAgent: request.headers.get('user-agent'),\n            vanguard: true\n        };\n\n        console.info(`[HYBRID-VANGUARD] Intenção de compra capturada: ${orderId}`, logData);\n        logtail.info(`Order captured: ${orderId}`, logData);\n\n        return json({\n            success: true,\n            orderId,\n            message: 'Pedido processado pela Edge Network',\n            vanguard: true\n        });\n    } catch (error) {\n        console.error('[HYBRID-VANGUARD] Falha no processamento:', error);\n        Sentry.captureException(error);\n        logtail.error(`Edge Processing Failure`, { error: error.message });\n        return json({ success: false, error: 'Internal Edge Error' }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAGA,MAAM,EAAE,QAAO,IAAK;AAEpB,MAAM,UAAU,IAAI,UAAU,IAAI,IAAI,QAAQ,QAAQ,IAAI,wBAAwB,YAAY,IAAI,EAAE,MAAM,MAAM;AAAC,GAAG,OAAO,MAAM;AAAC,EAAC;AAEvH,MAAC,SAAS;AAAA,EAClB,SAAS;AACb;AAGO,eAAe,KAAK,EAAE,WAAW;AACpC,MAAI;AACA,UAAM,OAAO,MAAM,QAAQ,KAAI;AAG/B,UAAM,YAAY,KAAK,IAAG,EAAG,SAAS,EAAE;AACxC,UAAM,YAAY,KAAK,SAAS,SAAS,EAAE,EAAE,UAAU,GAAG,CAAC;AAC3D,UAAM,UAAU,OAAO,SAAS,IAAI,SAAS,GAAG,YAAW;AAE3D,UAAM,UAAU;AAAA,MACZ;AAAA,MACA,YAAY,KAAK,OAAO;AAAA,MACxB,OAAO,KAAK;AAAA,MACZ,WAAW,QAAQ,QAAQ,IAAI,YAAY;AAAA,MAC3C,UAAU;AAAA,IACtB;AAEQ,YAAQ,KAAK,mDAAmD,OAAO,IAAI,OAAO;AAClF,YAAQ,KAAK,mBAAmB,OAAO,IAAI,OAAO;AAElD,WAAO,KAAK;AAAA,MACR,SAAS;AAAA,MACT;AAAA,MACA,SAAS;AAAA,MACT,UAAU;AAAA,IACtB,CAAS;AAAA,EACL,SAAS,OAAO;AACZ,YAAQ,MAAM,6CAA6C,KAAK;AAChE,WAAO,iBAAiB,KAAK;AAC7B,YAAQ,MAAM,2BAA2B,EAAE,OAAO,MAAM,SAAS;AACjE,WAAO,KAAK,EAAE,SAAS,OAAO,OAAO,yBAAyB,EAAE,QAAQ,KAAK;AAAA,EACjF;AACJ;"}