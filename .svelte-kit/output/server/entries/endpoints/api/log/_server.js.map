{"version":3,"file":"_server.js","sources":["../../../../../../../src/routes/api/log/+server.js"],"sourcesContent":["import { json } from '@sveltejs/kit';\nimport * as Sentry from \"@sentry/sveltekit\";\nimport pkg from \"@logtail/js\";\nconst { Logtail } = pkg;\n\nconst logtail = (pkg && pkg.Logtail) ? new pkg.Logtail(process.env.LOGTAIL_SOURCE_TOKEN || \"fake-token\") : { info: () => {}, error: () => {} };\n\nexport const config = {\n    runtime: 'edge'\n};\n\n/** @type {import('./$types').RequestHandler} */\nexport async function POST({ request }) {\n    try {\n        const logEntry = await request.json();\n        \n        const metadata = {\n            context: logEntry.context,\n            ts: logEntry.timestamp,\n            vanguard: true\n        };\n\n        console.log(`[VANGUARD-EDGE-LOG] [${logEntry.level}] ${logEntry.message}`, metadata);\n        \n        if (logEntry.level === 'error') {\n            logtail.error(logEntry.message, metadata);\n            Sentry.captureMessage(logEntry.message, { level: 'error', extra: metadata });\n        } else {\n            logtail.info(logEntry.message, metadata);\n        }\n\n        return json({ success: true });\n    } catch (e) {\n        Sentry.captureException(e);\n        return json({ success: false }, { status: 400 });\n    }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAGA,MAAM,EAAE,QAAO,IAAK;AAEpB,MAAM,UAAW,OAAO,IAAI,UAAW,IAAI,IAAI,QAAQ,QAAQ,IAAI,wBAAwB,YAAY,IAAI,EAAE,MAAM,MAAM;AAAC,GAAG,OAAO,MAAM;AAAC,EAAC;AAEhI,MAAC,SAAS;AAAA,EAClB,SAAS;AACb;AAGO,eAAe,KAAK,EAAE,WAAW;AACpC,MAAI;AACA,UAAM,WAAW,MAAM,QAAQ,KAAI;AAEnC,UAAM,WAAW;AAAA,MACb,SAAS,SAAS;AAAA,MAClB,IAAI,SAAS;AAAA,MACb,UAAU;AAAA,IACtB;AAEQ,YAAQ,IAAI,wBAAwB,SAAS,KAAK,KAAK,SAAS,OAAO,IAAI,QAAQ;AAEnF,QAAI,SAAS,UAAU,SAAS;AAC5B,cAAQ,MAAM,SAAS,SAAS,QAAQ;AACxC,aAAO,eAAe,SAAS,SAAS,EAAE,OAAO,SAAS,OAAO,UAAU;AAAA,IAC/E,OAAO;AACH,cAAQ,KAAK,SAAS,SAAS,QAAQ;AAAA,IAC3C;AAEA,WAAO,KAAK,EAAE,SAAS,MAAM;AAAA,EACjC,SAAS,GAAG;AACR,WAAO,iBAAiB,CAAC;AACzB,WAAO,KAAK,EAAE,SAAS,MAAK,GAAI,EAAE,QAAQ,KAAK;AAAA,EACnD;AACJ;"}